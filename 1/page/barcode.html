<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/css/barcode.css">
    <script src="/js/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="wrapper">
        <div class="content">
        <div class="lot">
                <div class="item_title">업체코드</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">EO번호</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">서열코드</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">EO번호</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="date">
                <div class="date_title">생산일자</div>
                <div class="date_text">
                    <input type="date" id="datePicker">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">부품4M</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">A or @</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">추적번호<br>(7~)</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">업체영역</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <div class="lot">
                <div class="item_title">Trailer</div>
                <div class="item_text">
                    <input type="text" id="lotInput" placeholder="값을 입력하세요" onfocus="this.select()">
                </div>
            </div>
            <button id="btn_print">PRINT</button>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            // 오늘 날짜를 기본값으로 설정
            const today = new Date().toISOString().split('T')[0];
            $('#datePicker').val(today);

            $('#btn_save').on('click', function () {
                const positions = [];
                $('.row2').each(function (index) {
                    const x = $(this).find('.x_value').val();
                    const y = $(this).find('.y_value').val();
                    const w = $(this).find('.w_value').val();
                    const h = $(this).find('.h_value').val();

                    if (x && y && w && h) {
                        positions.push(`${x},${y},${w},${h}`);
                    } else {
                        positions.push('0,0,0,0');
                    }
                });

                console.log(positions);

                $.ajax({
                    url: '/save_barcode_positions',
                    type: 'POST',
                    data: {
                        positions: positions
                    },
                    traditional: true,
                    success: function (data) {
                        alert(data.message);
                    },
                    error: function () {
                        alert('데이터 저장 요청 실패.');
                    }
                });
            });

            $('#btn_print').on('click', function () {
                const selectedOption = $('#partSelect option:selected');
                const partNumber = selectedOption.val(); // 선택된 part[0] (ID)
                const partName = selectedOption.data('part-name'); // 선택된 part[1] (이름)

                const positions = [];
                $('.row2').each(function () {
                    const x = $(this).find('.x_value').val() || '0'; // X 값
                    const y = $(this).find('.y_value').val() || '0'; // Y 값
                    const w = $(this).find('.w_value').val() || '0'; // W 값
                    const h = $(this).find('.h_value').val() || '0'; // H 값
                    positions.push(`${x},${y},${w},${h}`);
                });

                // PRINT 요청 전송
                const requestData = {
                    date: $('#datePicker').val(), // 날짜 입력 필드의 값
                    lotStart: $('#lotInput').val(), // LOT START 입력 필드의 값
                    partNumber: partNumber,
                    partName: partName,
                    qty: $('#qtyInput').val(), // 수량 입력 필드의 값
                    positions: positions
                };

                console.log('Request Data:', requestData);  // 요청 데이터 출력

                $.ajax({
                    url: '/print',
                    type: 'POST',
                    data: requestData,
                    success: function (data) {
                        alert(data.message);
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error('Error Status:', textStatus);
                        console.error('Error Thrown:', errorThrown);
                        alert('프린터 출력 요청 실패.');
                    }
                });
            });
        });
    </script>
</body>

</html>